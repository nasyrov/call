# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Commands

```bash
pnpm dev           # Start dev server with Turbopack
pnpm build         # Production build
pnpm lint          # ESLint only
pnpm lint:fix      # ESLint with auto-fix
pnpm typecheck     # TypeScript type checking
pnpm format        # Check formatting with Prettier
pnpm format:fix    # Fix formatting with Prettier
pnpm knip          # Check for unused files/exports/dependencies

# Database (Drizzle + PostgreSQL)
pnpm db:auth       # Regenerate auth schema from Better Auth config
pnpm db:generate   # Generate migrations from schema changes
pnpm db:migrate    # Run migrations
pnpm db:push       # Push schema directly (dev only)
pnpm db:studio     # Open Drizzle Studio GUI

# Start local PostgreSQL
docker compose up -d
```

## Architecture

This is a Next.js 15 app using the T3 Stack pattern with App Router.

### Key Technologies
- **Next.js 15** with Turbopack and App Router
- **Better Auth** for authentication (email/password)
- **Drizzle ORM** with PostgreSQL
- **Tailwind CSS v4** with PostCSS
- **@t3-oss/env-nextjs** for type-safe environment variables

### Path Aliases
- `~/` maps to `./src/`

### Project Structure
- `src/app/` - Next.js App Router pages and API routes
- `src/server/db/` - Database connection (`index.ts`) and schema (`schema/`)
- `src/server/db/schema/auth.ts` - Auth schema (auto-generated, do not edit manually)
- `src/server/better-auth/` - Auth configuration and server utilities
- `src/env.js` - Environment variable schema with Zod validation

### Authentication Flow
Better Auth is configured in `src/server/better-auth/config.ts`. The auth API routes are handled by a catch-all route at `src/app/api/auth/[...all]/route.ts`. Use `getSession()` from `~/server/better-auth/server` to get the current session in server components.

### Database
- Auth tables use plural names: `users`, `sessions`, `accounts`, `verifications`
- IDs use UUID type with `gen_random_uuid()` default
- `schema/auth.ts` is auto-generated by `pnpm db:auth` - do not edit manually

### Environment Variables
Required env vars are defined in `src/env.js`:
- `DATABASE_URL` - PostgreSQL connection string
- `BETTER_AUTH_SECRET` - Required in production

Set `SKIP_ENV_VALIDATION=1` to skip validation during builds.

## Code Style

- Use type-only imports: `import type { Foo } from ...` or `import { type Foo } from ...`
- Tailwind utility functions (`cn`, `cva`) are configured in Prettier for class sorting
- ESLint enforces Drizzle safety rules (require WHERE on delete/update)
